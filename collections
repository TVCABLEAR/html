function CollectionsListModel(n){var t=this;t.ContainerSelector=n;t.Context=undefined;t.uploadForm=null;t.URL={CreateCollectionFromFiles:"/action/Collections/CreateFromFiles"};t.init=function(){if(t.initUpload(),t.Context=$(t.ContainerSelector),t.Context.length!=0){Upload.changedCallbacks.Collections==undefined&&(Upload.changedCallbacks.Collections=t.updateTilesProgress);var n=new DescriptionEditModel;n.init()}};t.tilesModelsById=[];t.pageChanged=function(n){n===App.Pages.Collections&&t.updateTilesProgress()};t.updateTilesProgress=function(){var r=Upload.getFilesByCollection(),u=[],f,i,n;for(i in r)f=r[i],n=t.tilesModelsById[i],n==undefined&&(n=new CollectionTileModel(i),t.tilesModelsById[i]=n),n.init($(t.ContainerSelector)),n.update(f.length),u[n.Id]=1;for(i in t.tilesModelsById)u[i]||(n=t.tilesModelsById[i],n!=undefined)&&(n.init($(t.ContainerSelector)),n.update(0))};t.unfollow=function(n,t){if(n.handled(),t.IsSuccess){var i=n.context.closest("li > div");i.hide();$(t.Data).insertAfter(i)}else ShowNotification(t)};t.follow=function(n,t){if(n.handled(),t.IsSuccess){var i=n.context.closest("li > div");t.Data&&i.replaceWith(t.Data)}};t.followAgain=function(n,t){if(n.handled(),t.IsSuccess){var i=n.context.closest("li"),r=$("div:first",i),u=$("div.unfollow_confirm",i);r.show();u.remove()}else ShowNotification(t)};t.afterCollectionCreated=function(n){n.result.Type=="Data"&&n.result.IsSuccess&&(t.startUpload(n.result.Data.Id),n.context.attr("data-file-drop")==="1"&&Analytics.send("loggedin.createcollectionbydrop"),$(n.event.currentTarget).closeContainingDialog(),Navigation.getPage(n.result.Data.Url))};t.isProcessing=!1;t.collectionName="";t.initUpload=function(){(t.uploadForm=$("form#UploadFormCollections"),t.uploadForm.length<1||t.uploadForm.data("blueimp-fileupload"))||(App.enableUploadOverlay(),t.uploadForm.fileupload(),t.collectionName="",t.uploadForm.fileupload("option",{formData:t.uploadForm.serializeArray(),dropZone:$(document),autoUpload:!1,minFileSize:1}),t.uploadForm.bind("fileuploadadd",t.filesFileAdd),t.uploadForm.bind("fileuploaddrop",function(n,t){t.fileDropped=!0;Analytics.send("loggedin.dropfile")}))};t.filesFileAdd=function(n,i){var r,u,f;Windows.isModalOpened&&$(".dialog_upload_file",Windows.getCurrentDialog()).length<1||(i.fileDropped||Analytics.send("loggedin.clickhere"),r=i.files[0],i.guid=makeGuid(),u=$('<li class="template-upload"><p class="file_name">'+r.name+'<\/p><a href="#" class="del_ico uploadCancel"><\/a><\/li>').attr("data-guid",i.guid).data("data",i).appendTo(".filesTable",t.uploadForm),$("a.uploadCancel",u).click(t.cancelUpload),t.isProcessing)||(t.isProcessing=!0,f=App.findModuleId($(n.currentTarget)),t.collectionName=$("#CollectionForm input[name=Name]").val(),AJAX.get({Url:t.URL.CreateCollectionFromFiles,Callback:function(n){n.dialogOpened&&Windows.flagModuleDialog(f);$("#CollectionForm").attr("data-file-drop",i.fileDropped?1:0);$("#CollectionForm input[name=Name]").val(t.collectionName);t.showFilesOnNewCollectionWindow();t.isProcessing=!1;$(n.dialog).bind("dialogclose",t.onUploadWindowClose)}}))};t.onUploadWindowClose=function(){$(".filesTable",t.uploadForm).empty();$("input[name=Name]",$(".dialog_create_collection")).val("")};t.showFilesOnNewCollectionWindow=function(){$("#CollectionForm .filesContainer").html($(".filesTable",t.uploadForm).clone(!0))};t.startUpload=function(n){$(".template-upload",t.uploadForm).each(function(t,i){var r=$(i).data("data");r.collectionId=n;Upload.uploadFile(r)});$(".template-upload",t.uploadForm).remove()};t.cancelUpload=function(n){var i,t,r;n.preventDefault();i=$(n.currentTarget).closest(".template-upload,.template-download");t=i.data("data")||{};t.context=t.context||i;t.abort?t.abort():t.errorThrown="abort";r=i.closest(".filesTable");i.remove();$("#UploadFormCollections .filesTable li[data-guid="+t.guid+"]").remove();$("li",r).length==0&&r.closeContainingDialog()};t.markAsReaded=function(n){$("#followed_collections",t.Context).replaceWith(n.result);n.wasHandled=!0}}function DescriptionEditModel(){var n=this;n.URL={EditDescription:"/Action/Account/EditDescription",CancelDescription:"/Action/Account/GetAccountDescription"};n.init=function(){$(".initDescriptionEdit").on("click",n.initDescriptionEdit)};n.initDescriptionEdit=function(t){t.preventDefault();AJAX.post({Url:n.URL.EditDescription,Callback:n.BindDescriptionEdit})};n.BindDescriptionEdit=function(t){$("#accountDescription").html(t.Data.Content);$("#saveDescriptionForm").on("submit",n.DescriptionSave);$(".initDescriptionEdit").on("click",n.initDescriptionEdit);$("#cancelDescriptionEdit").on("click",n.DescriptionCancel);$("#saveDescriptionForm #Description").keyup(n.CountSigns);$("#saveDescriptionForm #Description").focus()};n.DescriptionSave=function(t){t.preventDefault();t.stopPropagation();$(t.currentTarget).process(n.BindDescriptionEdit)};n.DescriptionCancel=function(t){t.preventDefault();AJAX.post({Url:n.URL.CancelDescription,Callback:n.BindDescriptionEdit})};n.CountSigns=function(){var t=$(this).val(),n=t.length;n>500&&($(this).val(t.substring(0,500)),n=500);$("#signsCount").html(n)}}function CollectionTileModel(n){var t=this;t.Context=undefined;t.Id=n;t.init=function(n){n!=undefined&&(t.Context=n);t.Context.attr("data-collection-id")===undefined&&(t.Context=$("[data-collection-id="+t.Id+"]",t.Context))};t.getProgressElm=function(){return $(".cover_photo",t.Context)};t.update=function(n){var i,r;if(t.Context==0){console.error("Brak kafelka kolekcji "+t.Id);return}if(i=$(".cover_photo",t.Context),i.length==0&&($(".info",t.Context).after('<div class="cover_photo"><\/div>'),i=$(".cover_photo",t.Context)),n<1){i.removeClass("progress");$("p",i).remove();return}n>0&&(i.addClass("progress"),r=$("p",i),r.length==0&&(i.append("<p><\/p>"),r=$("p",i)),r.text("Uploading "+n+" files"))}}function RecomendedCollectionsListModel(n){var t=this;t.ContainerSelector=n;t.uploadRecommended=undefined;t.inited=!1;t.init=function(){var n=$(t.ContainerSelector);n.length!=0&&(t.inited||(t.inited=!0,n.click(t.show),$(".close_ico",n).click(function(n){n.preventDefault();n.stopPropagation();t.hide()}),$("body").click(t.hideOnClick)),$("a.btnEnterCollection",n).click(t.hideOnNavigate),$(".followed_list li a.name",n).click(t.hideOnNavigate),$(".followed_list li .followed_info",n).click(t.hideOnNavigate),BindTo(t,$(window),"scroll-recommended",function(n){n.scroll(t.scrolled)}),BindTo(t,$(window),"resize-recommended",function(n){n.resize(t.scrolled)}),t.uploadRecommended=new CollectionViewUploadEngineModel,t.uploadRecommended.init("#OtherRecommendedUpload"))};t.afterCollectionCreated=function(n){t.uploadRecommended.afterCollectionCreated(n)};t.recommendedVisible=!1;t.scrolled=function(){var f=$(t.ContainerSelector),i,n,r,u;if(!f.hasClass("expanded")){if($("body").hasClass("isMobile")){t.toggleAtBottom(!0);return}if(i=!1,n=!1,$("#collections").length>0?n=!0:(r=$("[data-file-last]"),r.length>0&&r.is(":visible")&&(n=!0),$(".empty_collection").length>0?t.isOnOwnCollection()==!1?(i=!0,n=!0):n=!1:$("#CollectionHeader").length>0&&(n=!0)),!n){t.toggleAtBottom(!1);return}u=$(document).height()-($(window).scrollTop()+$(window).height());u==0?t.toggleAtBottom(!0):u>f.height()&&i==!1&&t.toggleAtBottom(!1)}};t.isOnOwnCollection=function(){return $("input[name=IsOwnCollection]").val()=="1"};t.moreCollections=function(){$(".overlay").fadeOut()};t.toggleAtBottom=function(n){var i=$(t.ContainerSelector);n&&i.hasClass("expanded")==!1?(i.addClass("max on_page"),t.recommendedVisible=!0,t.sendStateInfo(1)):t.recommendedVisible&&t.isOnOwnCollection()==!1&&(i.removeClass("max on_page"),t.recommendedVisible=!1,t.sendStateInfo(0))};t.hideOnClick=function(n){var i=$(t.ContainerSelector);i.hasClass("expanded")&&!i.hasClass("on_page")&&($(n.target).closest(".ui-dialog").length>0||$(n.target).closest(t.ContainerSelector).length===0&&t.hide())};t.hideOnNavigate=function(){$("html").animate({scrollTop:0},"slow");$("body").animate({scrollTop:0},"slow",function(){t.hide()})};t.show=function(){var n=$(t.ContainerSelector);n.hasClass("on_page")||(n.hasClass("expanded")||($(".overlay").fadeIn(),n.addClass("max").animate({bottom:"+=354px"},"fast",function(){n.addClass("expanded")})),t.sendStateInfo(1))};t.hide=function(){var n=$(t.ContainerSelector);!n.hasClass("on_page")&&n.hasClass("expanded")&&($(".overlay").fadeOut(),n.animate({bottom:"-=354px"},"fast",function(){n.removeClass("max expanded");t.sendStateInfo(0)}))};t.pageChanged=function(n){var i=$(t.ContainerSelector),u,r;n===App.Pages.File||n===App.Pages.HomePage||n===App.Pages.Settings?i.hide():i.show();u=function(){return $(".tiles_container ul").length>0&&$(".tiles_container ul li:not(.new_file):not(.temporary_placeholder)").length==0?!1:$(".list_container").length>0&&$(".list_container .list_row").length==0?!1:!0};r=!1;(n==App.Pages.Collections||n==App.Pages.Collection)&&($(".empty_collection").length>0||$(".first_collection").length>0)?r=!0:n==App.Pages.Collection&&(i.show(),$(".list_container").length>0&&$(".list_container .list_row").length==0&&(r=!0),$(".tiles_container ul").length>0&&$(".tiles_container ul li:not(.new_file)").length==0&&(r=!0),t.isOnOwnCollection()&&(u()==!1?i.hide():r=!0));r?($(".overlay").hide(),i.addClass("max on_page"),t.sendStateInfo(1)):i.hasClass("on_page")&&(i.removeClass("max on_page"),t.hide());t.scrolled()};t.sendStateInfo=function(n){n?App.sendEvent("recommended.visible"):App.sendEvent("recommended.hidden")};t.unfollow=function(n,t){if(n.handled(),t.IsSuccess){var i=n.context.closest("li > div");i.hide();$(t.Data).insertAfter(i)}else ShowNotification(t)};t.follow=function(n,t){if(n.handled(),t.IsSuccess){var i=n.context.closest("li > div");t.Data&&i.replaceWith(t.Data)}};t.followAgain=function(n,t){if(n.handled(),t.IsSuccess){var i=n.context.closest("li"),r=$("div:first",i),u=$("div.unfollow_confirm",i);r.show();u.remove()}else ShowNotification(t)}}function HomePageModel(n){var t=this;t.ContainerSelector=n;t.URL={CreateCollectionFromFiles:"/action/Collections/CreateFromFiles"};t.pageChanged=function(n){n===App.Pages.HomePage?$("div#main").addClass("homePage"):$("div#main").removeClass("homePage")};t.newestCollectionScroller=undefined;t.loadingMoreNewest=!1;t.init=function(){t.survey=new Survey;t.survey.init();t.newestCollectionScroller=new CollectionsScroller;t.loadingMoreNewest=!1;t.newestCollectionScroller.shouldLoadCallback=function(){if(!t.loadingMoreNewest){t.loadingMoreNewest=!0;var n=$(".newest_collections .more_collections_link a");n.trigger("click");n.addClass("disabled")}};t.newestCollectionScroller.dontLoad=function(){t.loadMoreNewest=!1};$(window).scroll(function(){var n=$(this).scrollTop();n>10?$("#section2 .whatis").fadeOut():$("#section2 .whatis").fadeIn();n>$(window).height()-150?($(".topbar_container").addClass("bg_inherit"),$(".upload_transparent").fadeIn()):($(".upload_transparent").fadeOut(),$(".topbar_container").removeClass("bg_inherit"));t.newestCollectionScroller.scrolled()});$("#section2 .whatis").click(function(n){n.preventDefault();$("html, body").animate({scrollTop:$(window).height()-100},"slow")});t.initUpload()};t.isProcessing=!1;t.collectionName="";t.initUpload=function(){(t.uploadForm=$("form#cloudUpload"),t.uploadForm.length<1||t.uploadForm.data("blueimp-fileupload"))||(App.enableUploadOverlay(),t.uploadForm.fileupload(),t.collectionName="",t.uploadForm.fileupload("option",{formData:t.uploadForm.serializeArray(),dropZone:$(document),autoUpload:!1,minFileSize:1}),t.uploadForm.bind("fileuploadadd",t.filesFileAdd),t.uploadForm.bind("fileuploaddrop",function(n,t){t.fileDropped=!0;Analytics.send("unregistered.dropfile")}),t.initTopBarUpload())};t.initTopBarUpload=function(){var n=$("form#topBarUpload");n.length<1||n.data("blueimp-fileupload")||(n.fileupload(),n.fileupload("option",{formData:n.serializeArray(),autoUpload:!1,dropZone:null,minFileSize:1}),n.bind("fileuploadadd",function(n,t){return HomePage.uploadForm.fileupload("add",t),!1}))};t.filesFileAdd=function(n,i){var r,u,f;(i.fileDropped||Analytics.send("unregistered.clicktoupload"),r=i.files[0],i.guid=makeGuid(),u=$('<li class="template-upload"><p class="file_name">'+r.name+'<\/p><a href="#" class="del_ico uploadCancel"><\/a><\/li>').attr("data-guid",i.guid).data("data",i).appendTo(".filesTable",t.uploadForm),$("a.uploadCancel",u).click(t.cancelUpload),t.isProcessing)||(t.isProcessing=!0,f=App.findModuleId($(n.currentTarget)),t.collectionName=$("#CollectionForm input[name=Name]").val(),AJAX.get({Url:t.URL.CreateCollectionFromFiles,Callback:function(n){n.dialogOpened&&Windows.flagModuleDialog(f);$("#CollectionForm input[name=Name]").val(t.collectionName);t.showFilesOnNewCollectionWindow();t.isProcessing=!1;$(n.dialog).bind("dialogclose",t.onUploadWindowClose)}}))};t.onUploadWindowClose=function(){$(".filesTable",t.uploadForm).empty();$("input[name=Name]",$(".dialog_create_collection")).val("")};t.showFilesOnNewCollectionWindow=function(){$("#CollectionForm .filesContainer").html($(".filesTable",t.uploadForm).clone(!0))};t.startUpload=function(n){var i=0;return $(".template-upload",t.uploadForm).each(function(t,r){var u=$(r).data("data");u.collectionId=n;Upload.uploadFile(u);i++}),$(".template-upload",t.uploadForm).remove(),i};t.cancelUpload=function(n){var i,t,r;n.preventDefault();i=$(n.currentTarget).closest(".template-upload,.template-download");t=i.data("data")||{};t.context=t.context||i;t.abort?t.abort():t.errorThrown="abort";r=i.closest(".filesTable");i.remove();$("#UploadFormCollections .filesTable li[data-guid="+t.guid+"]").remove();$("li",r).length==0&&r.closeContainingDialog()};t.afterCollectionCreated=function(n){var r,u,i;n.result.IsSuccess&&n.result.Type=="Data"&&(r=n.result.Data.Url.indexOf("/t/")==0,u=t.startUpload(n.result.Data.Id,r),$(n.event.currentTarget).closeContainingDialog(),i=n.result.Data.Url,u==0&&i.indexOf("f=1")&&(i=i.replace("f=1",""),i=i.replace(/\?$/,""),i=i.replace(/&$/,"")),Navigation.getPage(i))};t.afterInlineCollectionCreated=function(n){n.result.IsSuccess||(n.handled(),$(".create_new_collections").html(n.result.Data.Content))};t.moreNewestCollections=function(n){n.result.Data.Content&&(n.handled(),$("ul",$(".newest_collections")).append(n.result.Data.Content),n.result.Data.HasMorePages==!1?n.context.remove():n.context.attr("href",n.result.Data.NextPageUrl),t.loadingMoreNewest=!1,n.context.removeClass("disabled"))};t.moreAdultCollections=function(n){var t;if(n.result.Data.Content){n.handled();t=$("ul",$(".adult_collections"));t.append(n.result.Data.Content);var i=Math.ceil($("li",t).length/4);t.parent().css("height",255*i+"px");n.result.Data.HasMorePages==!1?n.context.hide():n.context.attr("href",n.result.Data.NextPageUrl)}}}function CollectionsScroller(){var n=this;n.scrollTimer=undefined;n.lastScrollTop=0;n.shouldLoadCallback=undefined;n.shouldLoadCallbackTimer=undefined;n.scrolled=function(){n.scrollTimer&&clearTimeout(n.scrollTimer);n.scrollTimer=setTimeout(n.handleScrolled,100)};n.handleScrolled=function(){var t;if($(window).scrollTop()>n.lastScrollTop&&(t=$(".newest_collections .collections_list li"),t.length)){var i=t.offset().top+t.outerHeight(),r=$(window).scrollTop()+$(window).height();r-30>i&&(n.shouldLoadCallbackTimer&&clearTimeout(n.shouldLoadCallbackTimer),n.shouldLoadCallback&&(n.shouldLoadCallbackTimer=setTimeout(n.shouldLoadCallback,100)))}n.lastScrollTop=$(window).scrollTop()}}function Survey(){var n=this;n.intro=undefined;n.cookieName="sukb";n.init=function(){if(n.intro=$(".survey_intro"),n.intro.length!=0){$(".close_ico",n.intro).on("click",n.dismiss);$(".survey_start",n.intro).on("click",n.start);if(n.isDismissed()){n.close();return}n.intro.show()}};n.start=function(){n.close();var t=Windows.openFromElement($(".survey"));$(".surveyForm").on("submit",function(n){n.preventDefault();Windows.close();$(this).process()})};n.isDismissed=function(){for(var t,r=n.cookieName+"=",u=document.cookie.split(";"),i=0;i<u.length;i++)if(t=u[i].trim(),t.indexOf(r)==0)return t.substring(r.length,t.length)=="1";return!1};n.dismiss=function(t){t.preventDefault();n.close();var i=new Date;i.setTime(i.getTime()+864e5);document.cookie="sukb=1; expires="+i.toGMTString()+"; path=/"};n.close=function(){n.intro.hide()}}function CollectionEditModel(n){var t=this;t.ContainerSelector=n;t.wasOverayDisabled=!1;t.URL={ShowEditCoverForm:"/action/EditCollection/EditCoverForm"};t.init=function(){$("body").trigger("CollectionInit",t.getCurrentCollectionId());t.initHeaderButtons()};t.initHeaderButtons=function(){var i=$(".collection_action_buttons"),n,t;i.length>0&&(n=$(".followingCollection",i),t=$("input[type=submit]",n.closest("form")),n.mouseover(function(){n.hide();t.show()}),t.mouseout(function(){n.show();t.hide()}))};t.initEditCollectionForm=function(){var n,i,u,r;if(t.editCollectionForm=undefined,n=$("#CollectionEditForm"),n.validate().resetForm(),n.submit(t.submitCollectionEdit),$("input.cancelBtn").click(CloseContainingDialog),$("div.color_button").click(t.showColorPicker),$("div.color_picker li").click(t.chooseColor),$("label[for=col_adult]").attr("data-checked")==="1"&&(i=$("#col_adult"),i.attr("checked","checked"),i.closest(".icheckbox_minimal-grey").addClass("checked")),$("label[for=col_access_adult]").attr("data-checked")==="1"&&(i=$("#col_access_adult"),i.attr("checked","checked"),i.closest(".icheckbox_minimal-grey").addClass("checked")),n.closest(".ui-dialog-content").bind("dialogclose",t.onCloseEditCollectionDialog),$("input[type=radio]",n).each(function(){var n=$(this)}),u=$("#col_private"),u.length){u.attr("data-icheck-trigger","true").on("change",t.isPrivateChanged);r=n.validate().settings;r.rules.Password.required={depends:function(){return $("#col_private:checked").length}}}$("#col_access_private").length&&(r=n.validate().settings,r.rules.Password.required={depends:function(){return $("#col_access_private:checked").length}});$(".js-change-password").click(t.changePassword);$(".collection_access input[type=radio]").attr("data-icheck-trigger","true").on("change",t.accessOptionChanged);App.disableUploadOverlay()};t.accessOptionChanged=function(n){var i=$(n.currentTarget).closest(".js-option"),r;$(".collection_access .js-opt-password").hide();$(".collection_access .js-label",i).removeClass("active");r=$(".js-opt-password",i);r.length&&r.show();$(".js-label",i).addClass("active");$(".collection_access input[type=radio]").off("change").on("change",t.accessOptionChanged)};t.changePassword=function(n){n.preventDefault();$(".js-password").show();$(".js-change-password-container").hide()};t.isPrivateChanged=function(n){n.preventDefault();var t=$(n.currentTarget),u=t.closest("form"),i=u.validate().settings.rules,r=$(".js-password",t.closest(".private_info"));t.is(":checked")?(r.show(),i.Password.required={depends:function(){return $("#col_private:checked").length}}):(r.hide(),i.Password.required=!1,$(".js-change-password-container").hide())};t.showShareDialog=function(){$("#ShareCollectionUrl").select();$("#ShareCollectionUrl").click(function(){$("#ShareCollectionUrl").select()})};t.deleteConfirm=function(n,t){t.Type=="Redirect"&&t.Data&&t.Data.Type=="Info"&&ShowNotification(t.Data.Message)};t.onCloseEditCollectionDialog=function(){App.enableUploadOverlay()};t.unfollow=function(n,i){if(n.handled(),i.IsSuccess){var r=n.context.closest("div.collection_action_buttons");i.Data&&(r.replaceWith(i.Data),t.initHeaderButtons())}};t.follow=function(n,i){if(n.handled(),i.IsSuccess){var r=n.context.closest("div.collection_action_buttons");i.Data&&(r.replaceWith(i.Data),t.initHeaderButtons())}};t.showColorPicker=function(n){n.preventDefault();n.stopPropagation();$(this).addClass("active");var i=$("div.color_picker");i.slideDown();$(document).click(t.hideColorPicker)};t.hideColorPicker=function(){var n=$("div.color_picker");n.slideUp(function(){$("div.color_picker").parent().removeClass("active")});$(document).unbind("click",t.hideColorPicker)};t.chooseColor=function(n){n.preventDefault();var r=$(n.currentTarget),i=r.data("color");$(".color_container").css("background",i).show();$(".cover_photo_container").css("background",i);$("#CollectionEditForm input[name=CoverColor]").val(i);t.hideColorPicker();n.stopPropagation()};t.initEditPhotoForm=function(){t.initFileUpload()};t.onEditPhotoFormClose=function(){App.enableUploadOverlay()};t.editCollectionForm=undefined;t.initEditPhotoFormBefore=function(n){t.editCollectionForm=$("#CollectionEditForm");n.dialogOptions={stack:!0}};t.initFileUpload=function(){var n=$("form#EditCoverForm");n.length<1||(n.closest(".ui-dialog-content").bind("dialogclose",t.onEditPhotoFormClose),n.fileupload(),n.fileupload("option",{formData:n.serializeArray(),dropZone:$(".drag_and_drop_area"),autoUpload:!0,minFileSize:1,maxNumberOfFiles:1}),$(".drag_and_drop_area").bind("drop",function(n){n.preventDefault();n.stopPropagation()}),n.bind("fileuploaddone",t.fileSubmited),t.wasOverayDisabled=App.isOverlayDisabled(),App.disableUploadOverlay())};t.initDeleteWindow=function(){$("input.cancelBtn").click(CloseContainingDialog)};t.fileSubmited=function(n,i){var o,r,u;if(i.result.Type=="Window"){Windows.openFromResult(i.result);t.initEditPhotoForm();Navigation.bind();return}if(i.result.Type=="Data"){if(!i.result.IsSuccess){ShowNotification(i.result.Message);return}o=i.result.Data.Url;$("#SaveCoverPhotoForm input[name=fileName]").val(i.result.Data.FileName);$("#EditCoverForm").hide();var a=$("#stage"),v=$(".drag_me"),s=$(".mask_box");s.css("background-image","url("+o+")");var y=i.result.Data.Width,h=i.result.Data.Height,e=708,c=264,f=e/y*h,p=f*2-c,l=$("#CoverContainer");l.show();r=f-c;u=r/2;a.width(e).height(p).css("top",-1*r);s.css("backgroundPosition","0px -"+(-u+r)+"px").css("top",-u+r);v.height(f).css("top",u).draggable({containment:"parent",axis:"y"});l.data({W:e,H:h,SW:600,SH:f,Y:-u+r});$(document).on("drag",".drag_me",function(n,t){$("#CollectionEditContainer .mask_box").css("top",-t.position.top+r);$("#CollectionEditContainer .mask_box").css("left",0);$("#CollectionEditContainer .mask_box").css("backgroundPosition","0px -"+(-t.position.top+r)+"px");$("#CoverContainer").data({Y:-t.position.top+r})});$("#CoverEditSaveBtn").removeClass("ignored").removeClass("disabled")}};t.saveCoverPhoto=function(n){var i=$("#CoverContainer").data(),r=i.H/i.SH*i.Y;$("#SaveCoverPhotoForm input[name=x]").val(0);$("#SaveCoverPhotoForm input[name=y]").val(parseInt(r));t.editCollectionForm&&(n.handled(),$("#SaveCoverPhotoForm").process(function(){t.submitCollectionEditCore($(t.editCollectionForm))}))};t.submitCollectionEditCore=function(n){n.process(function(n){n.Type=="Window"?(Windows.openFromResult(n),Windows.flagModuleDialog(t.Id),Windows.lockOpen(),t.initEditPhotoForm(),t.initEditCollectionForm(),Navigation.bind(),$(".cover_photo").attr("style",$(".dialog_edit_collection .cover_photo_container").attr("style"))):n.IsSuccess?window.location=n.Data.Url:n.Message&&ShowNotification(n.Message)})};t.submitCollectionEdit=function(n){n.preventDefault();var i=$(n.currentTarget);$(".js-password input[type=text]",i).each(function(){var n=$(this).closest(".js-option"),t;n.length!=0&&(t=$("input[type=radio]",n),t.parent().hasClass("checked")==!1&&$(this).remove())});t.submitCollectionEditCore(i)};t.getCurrentCollectionId=function(){var n=$("#CollectionHeader");return n.length==0?-1:n.data("collection-id")}}function PagerModel(n,t,i){var r=this;r.Owner=t;r.ContainerSelector=n;r.mode=i;r.usePushState=!0;r.debug=!0;r.loadPageHandler=undefined;r.additionalOffset=100;r.listItemsSelector="li";r.attr={number:"data-nextpage-number",pageUrl:"data-nextpage-url",firstFile:"data-file-first",pageLoaded:"data-page-loaded"};r.pageSelector="["+r.attr.number+"]";r.splitterSelector=".pageSplitter";r.firstInit=!0;r.isActive=!1;r.callbackPageLoaded=undefined;r.init=function(n){var t,u,i,f,e;r.callbackPageLoaded=n;r.firstInit&&(r.firstInit=!1,r.usePushState&&Navigation.registerForStateChange(r.Owner),r.Owner.handleStateChanging=function(n){r.handleStateChanging(n)});r.isVisible()?(t=r.getContext(),t.length>0&&(u=$("[data-first-page-url]").attr("data-first-page-url"),i=$(r.listItemsSelector+":not(.new_file):first",t),i.attr(r.attr.pageLoaded,1).attr(r.attr.number,1).attr(r.attr.pageUrl,u),r.initPages(),f=History.getState(),f.data.pageNumber==undefined&&r.usePushState&&(e=r.removePagerFromUrl(document.location.href),Navigation.stateChangeSkipOnce(),History.replaceState(r.createStateData(i.attr(r.attr.number)),document.title,e))),BindTo(r,$(window),"scroll-"+r.mode,r.initWindowOnScroll),r.isActive===!1&&(r.isActive=!0,r.scrollToMarker()),r.scrollTop=$(window).scrollTop()):r.isActive=!1};r.initPages=function(){$(r.splitterSelector,r.getContext()).each(function(){var n=$(this),t=n.next();t.next().is("[data-file-id]")&&n.attr(r.attr.pageLoaded,1)})};r.scrollTimer=undefined;r.initWindowOnScroll=function(){$(window).scroll(function(){r.scrollTimer&&clearTimeout(r.scrollTimer);r.scrollTimer=setTimeout(r.scrolled,100)})};r.createStateDataHandler=undefined;r.createStateData=function(n){var t={};return r.createStateDataHandler?t=r.createStateDataHandler(n,r):t.collectionId=$("#CollectionHeader").attr("data-collection-id"),t.pageNumber=n,t.mode=r.mode,t};r.getContext=function(){return $(r.ContainerSelector,r.Owner.ContainerSelector)};r.topCalculationListOffset=!0;r.calculateTop=function(n,t){var i=t.offset().top;return r.topCalculationListOffset&&(i+=-n.offset().top+n.children(r.listItemsSelector).first().height()),i+r.additionalOffset};r.debugger=function(){var n,t;if(r.debug){n=r.getContext();t=$(r.pageSelector,n);$(".pagerDebug").remove();t.show();t.each(function(){var t=$(this),i=r.calculateTop(n,t);$("body").append('<div class="pagerDebug" style="width: 100%; border-bottom: 2px solid red; top: '+i+'px; left: 0px;position:absolute; color: red;">Page '+t.attr(r.attr.number)+" (top : "+i+"px)<\/div>")});var i=[],u=!1,f=1;$(r.listItemsSelector,n).each(function(){var n=$(this).attr("data-file-id");n!=undefined&&($(".name",$(this)).text(f+" (#"+n+")"),i[n]==undefined?i[n]=1:(i[n]++,u=!0),f++)});u&&console.error("Dupliaty!")}};r.scrollToMarker=function(){var t=r.getContext(),n=$("["+r.attr.firstFile+"]",t);n.length==1&&(window.scrollTo(0,r.calculateTop(t,n)),n.removeAttr(r.attr.firstFile))};r.scrollToPage=function(n){var i=$("["+r.attr.number+"="+n+"]",r.getContext()),t;i.length!=0&&(t=i.offset().top-r.additionalOffset,t<0&&(t=0),r.debug&&console.log("scrollTo top: "+t+"px (page "+n+")"),window.scrollTo(0,t))};r.loading=!1;r.currentPageNumber=1;r.lastScrollTop=0;r.isVisible=function(){var n=r.getContext();return n.length>0&&n.is(":visible")?!0:!1};r.scrolled=function(){if(r.pageHistoryChange){r.pageHistoryChange=!1;return}if(!r.loading&&r.isVisible()){var n=r.getContext(),i=$(r.pageSelector,n),t;t=$(window).scrollTop()>r.lastScrollTop?r.findNextPage(n,i):r.findPrevPage(n,i);t&&r.loadPage(t);r.lastScrollTop=$(window).scrollTop()}};r.findPrevPage=function(n){var o=$(window).scrollTop(),u,t=[],i,f,e;for(t.push($(r.listItemsSelector+":not(.new_file):first",n)),$(r.splitterSelector,n).each(function(){t.push($(this))}),i=t.length-1;i>=0;i--)f=t[i],e=f.offset().top,o<e&&(u=i>0?t[i-1]:t[0]);return u};r.findNextPage=function(n){var i=$(window).scrollTop()+$(window).height(),t;return $(r.splitterSelector,n).each(function(){var n=$(this),r=n.offset().top;if(i>r){t=$(this);return}}),t};r.loadPage=function(n){var t=n.attr(r.attr.pageUrl),u=document.title,i=n.attr(r.attr.number);if(n.attr(r.attr.pageLoaded)){r.currentPageNumber!=i&&(r.debug&&console.log("przelacz "+r.currentPageNumber+" --> "+i),r.currentPageNumber=i,r.usePushState&&(t=r.removePagerFromUrl(t),Navigation.pushState(r.createStateData(i),u,t)));return}r.currentPageNumber!=i&&(r.debug&&console.log("zaladuj: "+r.currentPageNumber+" --> "+i),r.loading=!0,r.loadPageHandler?r.loadPageHandler(i,function(){r.currentPageNumber=i;r.initPages();r.usePushState&&(t=r.removePagerFromUrl(t),Navigation.pushState(r.createStateData(i),u,t));r.loading=!1;r.callbackPageLoaded&&r.callbackPageLoaded()},r):(t+=t.indexOf("?")>=0?"&":"?",t+="ref=pager",AJAX.get({Url:t,Callback:function(n){var f,e;r.currentPageNumber=i;f=r.getContext();f.is("table")&&(e=$("tbody",f),e.length>0&&(f=e));f.append(n);r.initPages();r.usePushState&&(t=r.removePagerFromUrl(t),Navigation.pushState(r.createStateData(i),u,t));r.loading=!1;r.callbackPageLoaded&&r.callbackPageLoaded()}})))};r.nextPage=function(n){var t;n.handled();var u=$(n.context),f=u.attr(r.attr.pageNumber),i=undefined;for(t in r.Pages)if(r.Pages[t].number==f){i=r.Pages[t];break}r.loadPage(i)};r.pageHistoryChange=!1;r.removePagerFromUrl=function(n){var i,t;return n===undefined&&(n=document.location.href),i=n.indexOf("ref=pager"),i>=0&&(n=n.replace("ref=pager","").trim(),t=n[n.length-1],(t=="?"||t=="&")&&(n=n.substring(0,n.length-1))),n};r.handleStateChanging=function(n){r.isVisible()&&n.data.pageNumber&&n.data.mode==r.mode&&n.data.collectionId==$("#CollectionHeader").attr("data-collection-id")&&(n.handled(),r.pageHistoryChange=!0,r.scrollToPage(n.data.pageNumber))}}function FileDetailsDialogModel(){var n=this;n.ContainerSelector=".ui-dialog-content";n.init=function(t){var i;if(t!=undefined){t.handled();i={};t.context.closest("#SearchResults").length&&(i.source="search");var r=!1,u=function(n){var t=$("#AdultContentWarningForm",n);r&&t.length==0&&($(".adult_cover").each(function(){$(this).removeClass("adult_cover")}),$(".adult_info").remove());t.off("submit").on("submit",function(n){n.preventDefault();t.length&&(r=!0);AJAX.post({Url:$(this).attr("action"),Data:$(this).serialize(),Callback:function(){f()},PreventRequestHandle:!0,skipHandleRequest:!0})});if(i.source=="search")$(".js-adult-no",t).off("click").on("click",function(t){t.preventDefault();$(".ui-dialog-content",n).dialog("close")})},f=function(){t.event.type=="submit"?n.post(t.context,u):n.get(t.url,i,u)};f()}};n.navigate=function(t){t.preventDefault();var i=$(t.currentTarget);n.get(i.attr("href"))};n.saveFile=function(n){n.handled()};n.open=function(t,i){var f=$("<div>"+t+"<\/div>"),e=$("#fileDetails",f).css("padding",0).removeClass("responsive_width"),o,r,s,u;$(".next",f).addClass("ignore").click(n.navigate);$(".prev",f).addClass("ignore").click(n.navigate);o=$(".thumbnail img",e);o.length>0?(App.loader.show(),r=new Image,r.src=o.attr("src"),s=!1,u=function(){s==!1&&(s=!0,n.show(e,i),App.loader.hide())},r.onload=u,r.onerror=u,setTimeout(u,5e3)):n.show(e,i)};n.cleanUpModalLayout=function(n){n.off("dialogclose");n.remove()};n.startEditFile=function(){var t=$(".dialog_edit_collection form");t.attr("data-action-before","saveEditFile");t.parent().attr("data-module-id",n.Id);App.bind();Navigation.bind()};n.saveEditFile=function(n){n.handled();n.context.append('<input type="hidden" name="mode" value="dlg" />');n.context.process(function(n,t,i){n.Type==="Redirect"?(Windows.close(),Navigation.getPage(window.location.href,!1),App.bindAfterRequest()):n.Type==="Data"?(Windows.close(),Navigation.getPage(window.location.href,!1),App.bindAfterRequest(),ShowNotification(n.Message)):(App.handleRequest(n,i),App.bindAfterRequest())},{skipHandleRequest:1})};n.setupModalLayout=function(t){$(".ui-dialog-titlebar",t).hide();$(".close_ico",t).addClass("ignore").click(function(i){i.preventDefault();i.stopImmediatePropagation();$(".close_ico",t).removeClass("ignore");$(".ui-dialog-content").dialog("close");n.cleanUpModalLayout(t)});var i=$(".edit form",t);i.attr("data-action","startEditFile");i.parent().attr("data-module-id",n.Id);App.bind();Navigation.bind();t.on("dialogclose",function(){n.cleanUpModalLayout(t)}).css({position:"absolute",left:($(window).width()-t.outerWidth())/2,top:$(window).scrollTop()+50})};n.show=function(t,i){Windows.openFromText(t,undefined,{source:App.Pages.File,onOpen:function(t){n.setupModalLayout(t);i&&i(t)}})};n.get=function(t,i,r){AJAX.get({Url:t,Data:i,Callback:function(t){n.open(t,r)}})};n.post=function(t,i){AJAX.post({Url:t.attr("action"),Data:t.serialize(),Callback:function(t){t.dialogOpened||n.open(t,i)}})};n.retryWatchOnline=function(t){var i=t.context.attr("data-watchonline-file");i&&t.result.Type=="Redirect"&&(t.handled(),Windows.close(),n.lastWatchOnline.process(function(t){$("#fileDetails",t).length&&(n.open(t),n.lastWatchOnline=undefined)}))}}function FilesGalleryModel(n){var t=this;t.ContainerSelector=n;t.Pager=undefined;t.init=function(){t.Pager===undefined&&(t.Pager=new PagerModel(".tiles_container ul:first",t,"gallery"),t.Pager.listItemsSelector="li");t.Pager.init(function(){t.initImageSpinners()});t.initImageSpinners();t.initUploadOnGallery()};t.retryDownload=function(n){var t=0,i;n instanceof EventArgsModel?(i=n.context.attr("data-download-file"),i&&n.result.Type=="Redirect"&&(n.handled(),Windows.close(),t=i)):t=n;t&&$("[data-file-id="+t+"] .download_form").trigger("submit")};t.fidDialog=undefined;t.preview=function(n){if(!App.isMobile){if(t.fidDialog==undefined){var i=new FileDetailsDialogModel,r=App.findModuleByType(i);r==undefined?(t.fidDialog=i,App.register(t.fidDialog)):t.fidDialog=r}t.fidDialog.init(n)}};t.initImageSpinners=function(){$(".thumbnail").each(function(){var n=$(this),t=n.attr("data-thumb");t!=""&&$("<img>").attr("src",t).load(function(){n.attr("data-thumb","");n.find("div.thumb_spinner").remove();n.css("background-image",'url("'+t+'")')})})};t.initUploadOnGallery=function(){var n=$("form#UploadFormGallery");n.length<1||n.data("blueimp-fileupload")||(App.enableUploadOverlay(),n.fileupload(),n.fileupload("option",{formData:$("form#UploadFormGallery").serializeArray(),dropZone:$(document),autoUpload:!1,minFileSize:1}),n.bind("fileuploadadd",t.filesFileAdd),n.bind("fileuploaddrop",function(n,t){t.fileDropped=!0;Analytics.send("loggedin.dropfile")}),$("#UploadFormDialog a.btnStartUpload").click(t.filesStartUpload),$("#UploadFormDialogSingle a.btnStartUpload").click(t.filesStartSingleUpload))};t.filesFileAdd=function(n,i){var r,e,u,o,f,s,h;Windows.isModalOpened&&$(".dialog_upload_file",Windows.getCurrentDialog()).length<1||(i.fileDropped||Analytics.send("loggedin.clickhere"),r=i.files[0],i.guid=makeGuid(),e=$('<li class="template-upload"><p class="file_name">'+r.name+'<\/p><a href="#" class="del_ico uploadCancel"><\/a><\/li>').data("data",i).attr("data-guid",i.guid).appendTo("#UploadFormDialog .filesTable"),$("a.uploadCancel",e).click(t.cancelUpload),u=$("#UploadFormDialog .filesTable li").length,o=$("#UploadFormDialog").data("title"),u==1?(f=$("#UploadFormDialogSingle").children().clone(!0),$("p.file_name").html(r.name)):f=$("#UploadFormDialog").children().clone(!0),s={Title:o.replace("#COUNT",u),Content:f},h=Windows.openFromResult(s),h.bind("dialogclose",t.onUploadWindowClose))};t.onUploadWindowClose=function(){$(".filesTable",t.uploadForm).empty()};t.cancelUpload=function(n){var i,t,r;n.preventDefault();i=$(n.currentTarget).closest(".template-upload,.template-download");t=i.data("data")||{};t.context=t.context||i;t.abort?t.abort():t.errorThrown="abort";r=i.closest(".filesTable");i.remove();$("#UploadFormDialog .filesTable li[data-guid="+t.guid+"]").remove();$("li",r).length==0&&r.closeContainingDialog()};t.filesStartSingleUpload=function(n){var f=$(n.currentTarget).closest(".ui-dialog"),i=$("#UploadFormDialog .template-upload"),e=i.length,r,u;return e>1?t.filesStartUpload(n):(r=$(i[0]).data("data"),u=$("textarea[name=file_desc]",f).val(),r.description=u,t.filesStartUpload(n))};t.filesStartUpload=function(n){n.preventDefault();var t=$("#Gallery .tiles_container li:not(.new_file):not(.temporary_placeholder)").length>0;t?Analytics.send("collection.uploadoncollectionwithfiles"):Analytics.send("collection.uploadonemptycollection");$("#UploadFormDialog .template-upload").each(function(n,t){var i=$(t).data("data");Upload.uploadFile(i);$(".tiles_container .temporary_placeholder:first").remove()});$("#UploadFormDialog .template-upload").remove();$(n.currentTarget).closeContainingDialog()}}function FileDetailsModel(n){var t=this;t.ContainerSelector=n;t.Context=undefined;t.init=function(){var n=$("#AuthorizeCollectionFileAccessDialog"),i;if(n.length>0){i=Windows.openFromElement(n);i.on("dialogbeforeclose",function(){$(".empty_collection").show()});n.remove();$("#AuthorizeCollectionFileAccessDialogOverlay").remove();$("#AuthorizeCollectionFileAccessForm").submit(t.authorizeCollectionAccess);$("#recommended_collections").remove();$(".empty_collection").hide()}(t.Context=$(t.ContainerSelector),t.Context.length!=0)&&t.initPlayer()};t.lastDownload=undefined;t.beforeDownload=function(n){t.lastDownload=n.context};t.retryDownload=function(n){if(n instanceof EventArgsModel){var i=n.context.attr("data-download-file");i&&n.result.Type=="Redirect"&&(n.handled(),Windows.close(),t.lastDownload.process())}else t.lastDownload.process()};t.authorizeCollectionAccess=function(n){n.preventDefault();var i=$(n.currentTarget);AJAX.post({Url:i.attr("action"),Data:i.serialize(),Callback:function(n){n.IsSuccess?(Windows.close(),Navigation.getPage(n.Data.Url,!1)):(i.closest(".ui-dialog-content").html($("#AuthorizeCollectionFileAccessDialog","<div>"+n+"<\/div>").html()),$("#AuthorizeCollectionFileAccessForm").submit(t.authorizeCollectionAccess))}})};t.pageChanged=function(){};t.initPlayer=function(){var n=t.Context.attr("data-player");n!=""&&n!=undefined&&(n=="video"?t.startVideoPlayer():n=="music"&&t.startMusicPlayer())};t.fidDialog=undefined;t.lastWatchOnline=undefined;t.watchOnline=function(n){if(!App.isMobile){if(n.context.closest(".ui-dialog").length==0){t.lastWatchOnline=n.context;return}if(t.fidDialog==undefined){var i=new FileDetailsDialogModel,r=App.findModuleByType(i);r==undefined?(t.fidDialog=i,App.register(t.fidDialog)):t.fidDialog=r}t.fidDialog.lastWatchOnline=n.context;t.fidDialog.init(n)}};t.showShareDialog=function(){var n=$(".dialog_share_collection .link_share button");App.Clipboard.bindTo(n);$("#ShareFileUrl").select();$("#ShareFileUrl").click(function(){$("#ShareFileUrl").select()})};t.startVideoPlayer=function(){if($("#playerPlaceHolder",t.Context).length!=0){var n=t.getStreamUrl();n!=""&&n!=undefined&&(videojs.getPlayers().playerPlaceHolder&&videojs.getPlayers().playerPlaceHolder.dispose(),videojs("playerPlaceHolder",{controls:!0,techOrder:["html5","flash"],width:640,height:360},function(){this.src({type:"video/mp4",src:n})}))}};t.startMusicPlayer=function(){if($("#playerPlaceHolder",t.Context).length!=0){var n=t.getStreamUrl();n!=""&&n!=undefined&&(videojs.getPlayers().playerPlaceHolder&&videojs.getPlayers().playerPlaceHolder.dispose(),videojs("playerPlaceHolder",{controls:!0,autoplay:!0,techOrder:["html5","flash"],width:480,height:32},function(){this.src({type:"audio/mpeg",src:n})}))}};t.getStreamUrl=function(){return t.Context.attr("data-player-file")};t.retryWatchOnline=function(n){var i=n.context.attr("data-watchonline-file");i&&n.result.Type=="Redirect"&&(n.handled(),Windows.close(),t.lastWatchOnline.process(function(n){$("#fileDetails",n).length&&Navigation.html(n);t.lastWatchOnline=undefined}))}}function SortModel(n){var t=this;t.ContainerSelector=n;t.Context=undefined;t.init=function(){var f;if(t.Context=$(t.ContainerSelector),t.Context.length!=0){var i=t.Context,n=$(".sort_list",i),r=$(".sort_select",i),e=$(".sort_select i",i).innerWidth(),u=n.show().innerWidth();n.hide();$("span",r).width(u-20);n.css("right","34px");r.click(function(){$(this).parent().hasClass("disabled")||(n.slideDown("fast"),$(this).addClass("active"))});f=$("li",n);$("li",n).each(function(){});i.mouseleave(function(){n.slideUp("fast");r.removeClass("active")})}}}function FilesListModel(n){var t=this;t.ContainerSelector=n;t.Pager=undefined;t.init=function(){t.Pager===undefined&&(t.Pager=new PagerModel(".list_view .list_container",t,"list"),t.Pager.topCalculationListOffset=!1,t.Pager.additionalOffset=-15,t.Pager.listItemsSelector=".list_row",t.Pager.splitterSelector=".pageSplitterBorder");t.Pager.init();t.initUploadOnFilesList()};t.retryDownload=function(n){var t=0,i;n instanceof EventArgsModel?(i=n.context.attr("data-download-file"),i&&n.result.Type=="Redirect"&&(n.handled(),Windows.close(),t=i)):t=n;t&&$("[data-file-id="+t+"] .download_form").trigger("submit")};t.fidDialog=undefined;t.preview=function(n){if(!App.isMobile){if(t.fidDialog==undefined){var i=new FileDetailsDialogModel,r=App.findModuleByType(i);r==undefined?(t.fidDialog=i,App.register(t.fidDialog)):t.fidDialog=r}t.fidDialog.init(n)}};t.initUploadOnFilesList=function(){var n=$("form#UploadFormFiles");n.length<1||n.data("blueimp-fileupload")||(App.enableUploadOverlay(),n.fileupload(),n.fileupload("option",{formData:$("form#UploadFormFiles").serializeArray(),dropZone:$("body"),autoUpload:!1,minFileSize:1}),n.bind("fileuploadadd",t.filesFileAdd),n.bind("fileuploaddrop",function(n,t){t.fileDropped=!0;Analytics.send("loggedin.dropfile")}),$("#UploadFormDialog a.btnStartUpload").click(t.filesStartUpload),$("#UploadFormDialogSingle a.btnStartUpload").click(t.filesStartSingleUpload))};t.filesFileAdd=function(n,i){var r,e,u,o,f,s,h;Windows.isModalOpened&&$(".dialog_upload_file",Windows.getCurrentDialog()).length<1||(i.fileDropped||Analytics.send("loggedin.clickhere"),r=i.files[0],i.guid=makeGuid(),e=$('<li class="template-upload"><p class="file_name">'+r.name+'<\/p><a href="#" class="del_ico uploadCancel"><\/a><\/li>').data("data",i).attr("data-guid",i.guid).appendTo("#UploadFormDialog .filesTable"),$("a.uploadCancel",e).click(t.cancelUpload),u=$("#UploadFormDialog .filesTable li").length,o=$("#UploadFormDialog").data("title"),u==1?(f=$("#UploadFormDialogSingle").children().clone(!0),$("p.file_name").html(r.name)):f=$("#UploadFormDialog").children().clone(!0),s={Title:o.replace("#COUNT",u),Content:f},h=Windows.openFromResult(s),h.bind("dialogclose",t.onUploadWindowClose))};t.onUploadWindowClose=function(){$(".filesTable",t.uploadForm).empty()};t.cancelUpload=function(n){var i,t,r;n.preventDefault();i=$(n.currentTarget).closest(".template-upload,.template-download");t=i.data("data")||{};t.context=t.context||i;t.abort?t.abort():t.errorThrown="abort";r=i.closest(".filesTable");i.remove();$("#UploadFormDialog .filesTable li[data-guid="+t.guid+"]").remove();$("li",r).length==0&&r.closeContainingDialog()};t.filesStartSingleUpload=function(n){var f=$(n.currentTarget).closest(".ui-dialog"),i=$("#UploadFormDialog .template-upload"),e=i.length,r,u;return e>1?t.filesStartUpload(n):(r=$(i[0]).data("data"),u=$("textarea[name=file_desc]",f).val(),r.description=u,t.filesStartUpload(n))};t.filesStartUpload=function(n){n.preventDefault();var t=$("#FilesList .list_container  div.list_row").length>0;t?Analytics.send("collection.uploadoncollectionwithfiles"):Analytics.send("collection.uploadonemptycollection");$("#UploadFormDialog .template-upload").each(function(n,t){var i=$(t).data("data");Upload.uploadFile(i)});$("#UploadFormDialog .template-upload").remove();$(n.currentTarget).closeContainingDialog()}}function CollectionDetailsModel(n){var t=this;t.ContainerSelector=n;t.winWidth=630;t.enabled=!1;t.onlyGalleryMode=!1;t.inited=!1;t.init=function(){(Navigation.registerForStateChange(t),t.initChangePassword(),App.isMobile==!1||t.inited)||(t.inited=!0,$(window).resize(t.onResize))};t.pageChanged=function(n){t.enabled=n==App.Pages.Collection};t.onResize=function(){if(t.enabled!=!1){var n=$(window).width();n<t.winWidth&&!t.onlyGalleryMode&&(t.onlyGalleryMode=!0,$("#FilesList").length>0&&$(".view_switch .gallery").trigger("click"));n>=t.winWidth&&t.onlyGalleryMode&&(t.onlyGalleryMode=!1)}};t.initChangePassword=function(){var n=$("#SetCollectionPasswordDialog");n.length>0&&(Windows.openFromElement(n,{persistent:1}),n.remove(),$("#SetCollectionPasswordDialogOverlay").remove(),$("#SetCollectionPasswordForm").submit(t.setPassword))};t.setPassword=function(n){n.preventDefault();var i=$(n.currentTarget);AJAX.post({Url:i.attr("action"),Data:i.serialize(),Callback:function(n){n.IsSuccess?(Windows.close(),Navigation.broadcastCall("collectionPasswordSet")):(i.closest(".ui-dialog-content").html(n),i.submit(t.setPassword))}})};t.handleStateChanged=function(){t.initChangePassword()}}function PrivateCollectionModel(n){var t=this;t.ContainerSelector=n;t.init=function(){var n=$("#AuthorizeCollectionAccessDialog"),i;if(n.length>0){i=Windows.openFromElement(n);i.on("dialogbeforeclose",function(){$(".empty_collection").show()});n.remove();$("#AuthorizeCollectionAccessDialogOverlay").remove();$("#AuthorizeCollectionAccessForm").submit(t.authorizeCollectionAccess);$("#recommended_collections").remove();$(".empty_collection").hide()}};t.authorizeCollectionAccess=function(n){n.preventDefault();var i=$(n.currentTarget);AJAX.post({Url:i.attr("action"),Data:i.serialize(),Callback:function(n){n.IsSuccess?(Windows.close(),Navigation.getPage(n.Data.Url,!1)):(i.closest(".ui-dialog-content").html($("#AuthorizeCollectionAccessDialog","<div>"+n+"<\/div>").html()),$("#AuthorizeCollectionAccessForm").submit(t.authorizeCollectionAccess))}})}}function EmptyCollectionModel(n){var t=this;t.ContainerSelector=n;t.uploadFiles=undefined;t.uploadFolder=undefined;t.init=function(){var i=$("#UploadFromEmptyDialogSingle"),r=$("#UploadFromEmptyDialogMany"),n;t.uploadFiles=new EmptyCollectionUpload(!0);n=$("#UploadFolderFromEmpty");n.length>0&&(t.uploadFolder=new EmptyCollectionUpload(!0),t.uploadFolder.gaSuffix="folder",t.uploadFiles.fileDropEnabled=!1,t.uploadFolder.init(n,i,r));t.uploadFiles.init($("#UploadFilesFromEmpty"),i,r)}}function EmptyCollectionUpload(n){var t=this;t.fileDropEnabled=n;t.gaSuffix="file";t.init=function(n,i,r){if(!(n.length<1)&&!n.data("blueimp-fileupload")){t.uploadForm=n;t.singleFileDialog=t.cloneDialog(n,i);t.manyFilesDialog=t.cloneDialog(n,r);App.enableUploadOverlay();n.fileupload();var u={formData:n.serializeArray(),autoUpload:!1,minFileSize:1};t.fileDropEnabled&&(u.dropZone=$(document));n.fileupload("option",u);n.bind("fileuploaddrop",function(n,t){t.fileDropped=!0;Analytics.send("loggedin.dropfile")});n.bind("fileuploadadd",t.filesFileAdd);t.manyFilesDialog&&$("a.btnStartUpload",t.manyFilesDialog).click(t.filesStartUpload);t.singleFileDialog&&$("a.btnStartUpload",t.singleFileDialog).click(t.filesStartSingleUpload)}};t.cloneDialog=function(n,t){if(t==undefined)return undefined;var i=t.clone();return i.attr("id",n.attr("id")+"-"+i.attr("id")),t.parent().append(i),i};t.filesFileAdd=function(n,i){var r,e,u,o,f,s,h;Windows.isModalOpened&&$(".dialog_upload_file",Windows.getCurrentDialog()).length<1||(t.fileDropEnabled||!i.fileDropped)&&(i.fileDropped||(t.gaSuffix=="file"?Analytics.send("loggedin.clickhere"):Analytics.send("loggedin.clickherefolder")),r=i.files[0],i.guid=makeGuid(),e=$('<li class="template-upload"><p class="file_name">'+r.name+'<\/p><a href="#" class="del_ico uploadCancel"><\/a><\/li>').data("data",i).attr("data-guid",i.guid).appendTo($(".filesTable",t.manyFilesDialog)),$("a.uploadCancel",e).click(t.cancelUpload),u=$(".filesTable li",t.manyFilesDialog).length,o=t.manyFilesDialog.data("title"),u==1?(f=t.singleFileDialog.children().clone(!0),$("p.file_name").html(r.name)):f=t.manyFilesDialog.children().clone(!0),s={Title:o.replace("#COUNT",u),Content:f},h=Windows.openFromResult(s),h.bind("dialogclose",t.onUploadWindowClose))};t.onUploadWindowClose=function(){$(".filesTable",t.uploadForm).empty()};t.cancelUpload=function(n){var r,i,u;n.preventDefault();r=$(n.currentTarget).closest(".template-upload,.template-download");i=r.data("data")||{};i.context=i.context||r;i.abort?i.abort():i.errorThrown="abort";u=r.closest(".filesTable");r.remove();$(".filesTable li[data-guid="+i.guid+"]",t.manyFilesDialog).remove();$("li",u).length==0&&u.closeContainingDialog()};t.filesStartSingleUpload=function(n){var f=$(n.currentTarget).closest(".ui-dialog"),i=$(".template-upload",t.manyFilesDialog),e=i.length,r,u;return e>1?t.filesStartUpload(n):(r=$(i[0]).data("data"),u=$("textarea[name=file_desc]",f).val(),r.description=u,t.filesStartUpload(n))};t.filesStartUpload=function(n){n.preventDefault();var r=function(n,t,i){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),u=n.indexOf("?")!==-1?"&":"?";return n.match(r)?n.replace(r,"$1"+t+"="+i+"$2"):n+u+t+"="+i},u=r(document.location.href,"f","2"),i=[];$(".template-upload",t.manyFilesDialog).each(function(n,t){var r=$(t).data("data");i.push(r)});Navigation.getPage(u,!1,function(){for(var r=0;r<i.length;r++)Upload.uploadFile(i[r]);$(".template-upload",t.manyFilesDialog).remove();$(n.currentTarget).closeContainingDialog()})}}function ErrorModel(n){var t=this;t.ContainerSelector=n;t.init=function(){};t.pageChanged=function(n){n===App.Pages.Error?$("body").addClass("error_page"):$("body").removeClass("error_page")}}function AccountModel(n){var t=this;t.ContainerSelector=n;t.wasOverayDisabled=!1;t.wasAvatarChanged=!1;t.Url={ChooseAvatar:"/Action/Account/ChooseAvatar",ChooseAvatarRegister:"/Action/Account/ChooseAvatarRegistration",SetAvatarColor:"/Action/Account/SetAvatarColor"};t.init=function(){var n=$(t.ContainerSelector);$("p.step1 a",n).click(function(t){t.preventDefault();$("p.step1",n).hide();$("p.step2",n).show()})};t.initAvatarDialog=function(n){if($("div.color_button").click(t.showColorPicker),$("div.color_picker li").click(t.chooseColor),$("#ShowAvatarUploadForm").submit(t.showAvatarUpload),n){var i;n.result&&n.result.dialog?i=$(n.result.dialog):n.dialog&&(i=$(n.dialog));i&&i.bind("dialogclose",t.onDialogClose).addClass("doNotClose")}};t.showAvatarDialog=function(){AJAX.post({Url:t.Url.ChooseAvatar,Callback:t.initAvatarDialog})};t.showAvatarDialogRegister=function(){AJAX.post({Url:t.Url.ChooseAvatarRegister,Callback:t.initAvatarDialog})};t.afterRegister=function(n){n.result&&n.result.Type&&n.result.Type=="Redirect"&&(Analytics.send("unregistered.signup.success"),t.showAvatarDialogRegister())};t.showColorPicker=function(n){n.preventDefault();n.stopPropagation();$(this).addClass("active");var i=$("div.color_picker");i.slideDown();$(document).click(t.hideColorPicker)};t.hideColorPicker=function(){var n=$("div.color_picker");n.slideUp(function(){$("div.color_picker").parent().removeClass("active")});$(document).unbind("click",t.hideColorPicker)};t.chooseColor=function(n){n.preventDefault();var r=$(n.currentTarget),i=r.data("color");$(".color_container").css("background",i).show();AJAX.post({Url:t.Url.SetAvatarColor,Data:{color:i},Callback:function(n){n.IsSuccess&&(t.initAvatarDialog(),t.wasAvatarChanged=!0)}});$("div.color_picker").hide();n.stopPropagation()};t.reloadPage=function(){window.location=window.location};t.showAvatarUpload=function(n){n.preventDefault();var i=$(n.currentTarget),r=i.attr("action");AJAX.post({Url:r,Callback:t.initAvatarUpload})};t.initAvatarUpload=function(n){var i=$("#UploadAvatarForm");i.length<1||(t.wasOverayDisabled=App.isOverlayDisabled(),App.disableUploadOverlay(),i.fileupload(),i.fileupload("option",{formData:i.serializeArray(),dropZone:$(".drag_and_drop_area"),autoUpload:!0}),$(".drag_and_drop_area").bind("drop",function(n){n.preventDefault();n.stopPropagation()}),i.bind("fileuploaddone",t.fileSubmited),n.dialog&&$(".ui-dialog-content",n.dialog).bind("dialogclose",t.onDialogClose))};t.onDialogClose=function(){t.wasOverayDisabled||App.enableUploadOverlay();t.wasAvatarChanged&&t.reloadPage()};t.fileSubmited=function(n,i){if(!i.result.IsSuccess){ShowNotification(i.result.Message);return}t.showAvatarDialog();t.wasAvatarChanged=!0}}function AbuseModel(n){var t=this;t.ContainerSelector=n;t.init=function(){$(".qtip_title").qtip({position:{my:"top center",at:"bottom center",adjust:{y:3},effect:function(n,t){$(this).animate(t,{duration:600,easing:"linear",queue:!1})}},style:{tip:{width:10,height:5}}})};t.reloadOnSuccess=function(n){n.result.Type=="Info"&&n.result.IsSuccess==!0&&location.reload()}}function MailingDemoModel(n){var t=this;t.ContainerSelector=n;t.Context=$(t.ContainerSelector);t.init=function(){$(t.ContainerSelector).on("ifChecked","input",function(){$("form",t.Context).submit()})};t.reloadMessage=function(n){n.result.Data&&($("#messagePreview").html(n.result.Data.Body),$("#messagePreviewBox").show())}}function CollectionsAdministrativeOptionsModel(n){var t=this;t.ContainerSelector=n;t.init=function(){};t.collectionChanged=function(n,t){if(t.IsSuccess){var i=n.context.closest(".admin_info");t.Data&&i.html(t.Data)}}}function UserNotificationsModel(n){var t=this;t.ContainerSelector=n;t.init=function(){$("a.see_more").click(t.Dismiss);$("a.close_ico").click(t.Dismiss);Navigation.registerForStateChange(t)};t.Dismiss=function(n){n.preventDefault();var i=$(this),r=$(this).closest(".user_notification");AJAX.post({Url:i.attr("href"),Callback:function(){t.HideUserNotification(r)}})};t.HideUserNotification=function(n){n&&n.slideUp()};t.checkTimeout=undefined;t.collectionPasswordSet=function(){t.checkTimeout&&clearTimeout(t.checkTimeout);t.checkTimeout=setTimeout(t.collectionPasswordSetProcess,300)};t.collectionPasswordSetProcess=function(){var n=$("#user_notifications"),t;n.length!=0&&(t=n.attr("data-refresh"),t&&AJAX.get({Url:t,Callback:function(t){n.replaceWith(t)}}))};t.handlePushState=function(){t.collectionPasswordSet()}}function SettingsModel(n){var t=this;t.ContainerSelector=n;t.init=function(){var n=$(t.ContainerSelector);n.length!=0&&($.validator.unobtrusive.parse("#changePasswordForm"),$.validator.unobtrusive.parse("#changeEmailForm"),$("#changeEmailForm input[type=text]").keyup(t.activateEmailSubmit),$("#changePasswordForm input[type=password]").keyup(t.activatePasswordSubmit),$(".avatar_change").click(t.changeAvatarInit),$("#accountAdultContentForm input[type=checkbox]").change(t.submitAdultContentSwitch))};t.submitAdultContentSwitch=function(n){$(n.currentTarget).closest("form").trigger("submit")};t.changeAvatarInit=function(n){n.preventDefault();var t=$(n.target).closest("form");t.submit()};t.activateEmailSubmit=function(){$("#changeEmailForm input[type=submit]").removeClass("disabled").removeAttr("disabled")};t.activatePasswordSubmit=function(){$("#changePasswordForm input[type=submit]").removeClass("disabled").removeAttr("disabled")};t.reloadOnSuccess=function(n){n.result.Type=="Info"&&n.result.IsSuccess==!0&&location.reload()}}function CollectionViewUploadModel(n){var t=this;t.ContainerSelector=n;t.upload=undefined;t.uploadMinimized=undefined;t.init=function(){$(".minimizeBox a",t.ContainerSelector).on("click",t.minimizeBox);$(".uploadEncouragementMin").on("mouseover",t.minBoxOver);$(".uploadEncouragementMin").on("mouseout",t.minBoxOut);t.useBigBoxDelayStart=!0;t.isSmallBoxMode=t.isMinimized();t.show();t.uploadMinimized=new CollectionViewUploadEngineModel;t.uploadMinimized.init("#CollectionViewUploadMinimized");t.upload=new CollectionViewUploadEngineModel;t.upload.init("#CollectionViewUpload")};t.pageChanged=function(n){n==App.Pages.Collection?t.show():t.hide()};t.afterCollectionCreated=function(n){t.isSmallBoxMode?t.uploadMinimized.afterCollectionCreated(n):t.upload.afterCollectionCreated(n)};t.isSmallBoxMode=!1;t.useBigBoxDelayStart=!0;t.hide=function(){t.cancelBigDelay();$(".uploadEncouragement").hide();$(".uploadEncouragementMin").hide()};t.showBigTimeout=undefined;t.cancelBigDelay=function(){t.showBigTimeout&&(clearTimeout(t.showBigTimeout),t.showBigTimeout=undefined)};t.showBigDelay=function(){t.cancelBigDelay();t.useBigBoxDelayStart?t.showBigTimeout=setTimeout(t.showBig,1e4):t.showBig()};t.showBig=function(){$(".uploadEncouragement").show();t.useBigBoxDelayStart=!1};t.show=function(){if($("input[name=IsOwnCollection]").val()=="1"){t.hide();return}var n=$("#recommended_collections");if(n.hasClass("max")||n.hasClass("on_page")||n.hasClass("expanded")){t.hide();return}t.isSmallBoxMode?($(".uploadEncouragement").hide(),$(".uploadEncouragementMin").show()):(t.showBigDelay(),$(".uploadEncouragementMin").hide())};t.eventListener=function(n){n=="recommended.visible"?t.hide():n=="recommended.hidden"&&t.show()};t.minBoxOver=function(){var n=$(".uploadEncouragementMin");$(".mouseover",n).show();$(".mouseout",n).hide()};t.minBoxOut=function(){var n=$(".uploadEncouragementMin");$(".mouseover",n).hide();$(".mouseout",n).show()};t.isMinimized=function(){for(var n,i="uem=",r=document.cookie.split(";"),t=0;t<r.length;t++)if(n=r[t].trim(),n.indexOf(i)==0)return n.substring(i.length,n.length)=="1";return!1};t.minimizeBox=function(n){var i,r,u;n&&n.preventDefault();i=new Date;i.setTime(i.getTime()+2592e6);document.cookie="uem=1; expires="+i.toGMTString()+"; path=/";r=$(".uploadEncouragementMin");u=r.height();$(".uploadEncouragement").css("white-space","nowrap").animate({height:u,width:r.width(),opacity:.4},{duration:300,complete:function(){$(this).hide();r.show()}});t.isSmallBoxMode=!0}}function CollectionViewUploadEngineModel(){var n=this;n.URL={CreateCollectionFromFiles:"/action/Collections/CreateFromFiles"};n.isProcessing=!1;n.collectionName="";n.init=function(t){(n.uploadForm=$(t),n.uploadForm.length<1||n.uploadForm.data("blueimp-fileupload"))||(n.uploadForm.fileupload(),n.collectionName="",n.uploadForm.fileupload("option",{formData:n.uploadForm.serializeArray(),autoUpload:!1,minFileSize:1}),n.uploadForm.bind("fileuploadadd",n.filesFileAdd),n.uploadForm.bind("fileuploaddrop",function(n){n.preventDefault()}),n.initTopBarUpload())};n.initTopBarUpload=function(){var n=$("form#topBarUpload");n.length<1||n.data("blueimp-fileupload")||(n.fileupload(),n.fileupload("option",{formData:n.serializeArray(),autoUpload:!1,dropZone:null,minFileSize:1}),n.bind("fileuploadadd",function(n,t){return HomePage.uploadForm.fileupload("add",t),!1}))};n.filesFileAdd=function(t,i){var r,u,f;(i.fileDropped||Analytics.send("unregistered.clicktoupload"),r=i.files[0],i.guid=makeGuid(),u=$('<li class="template-upload"><p class="file_name">'+r.name+'<\/p><a href="#" class="del_ico uploadCancel"><\/a><\/li>').attr("data-guid",i.guid).data("data",i).appendTo(".filesTable",n.uploadForm),$("a.uploadCancel",u).click(n.cancelUpload),n.isProcessing)||(n.isProcessing=!0,f=App.findModuleId($(t.currentTarget)),n.collectionName=$("#CollectionForm input[name=Name]").val(),AJAX.get({Url:n.URL.CreateCollectionFromFiles,Callback:function(t){t.dialogOpened&&Windows.flagModuleDialog(f);$("#CollectionForm input[name=Name]").val(n.collectionName);n.showFilesOnNewCollectionWindow();n.isProcessing=!1;$(t.dialog).bind("dialogclose",n.onUploadWindowClose)}}))};n.onUploadWindowClose=function(){$(".filesTable",n.uploadForm).empty();$("input[name=Name]",$(".dialog_create_collection")).val("")};n.showFilesOnNewCollectionWindow=function(){$("#CollectionForm .filesContainer").html($(".filesTable",n.uploadForm).clone(!0))};n.startUpload=function(t){$(".template-upload",n.uploadForm).each(function(n,i){var r=$(i).data("data");r.collectionId=t;Upload.uploadFile(r)});$(".template-upload",n.uploadForm).remove()};n.cancelUpload=function(n){var i,t,r;n.preventDefault();i=$(n.currentTarget).closest(".template-upload,.template-download");t=i.data("data")||{};t.context=t.context||i;t.abort?t.abort():t.errorThrown="abort";r=i.closest(".filesTable");i.remove();$("#UploadFormCollections .filesTable li[data-guid="+t.guid+"]").remove();$("li",r).length==0&&r.closeContainingDialog()};n.afterCollectionCreated=function(t){if(t.result.IsSuccess&&t.result.Data&&t.result.Data.Id){var i=t.result.Data.Url.indexOf("/t/")==0;n.startUpload(t.result.Data.Id,i);$(t.event.currentTarget).closeContainingDialog();Navigation.getPage(t.result.Data.Url)}}}function CollectionShare(n){var t=this;t.ContainerSelector=n;t.afterAnonymusFollow=function(n){n.handled();n.result.IsSuccess?$("#CollectionShare").html(""):$("#CollectionShare").html(n.result.Data.Content)};t.followChanged=function(n){n.result.IsSuccess&&(n.handled(),$("#CollectionShare").html(n.result.Data.Content),Navigation.bind(),MixpanelReport("Follow"))};t.init=function(){}}function OAuthModel(n){var t=this;t.ContainerSelector=n;t.DataKeys={Authorized:"authorized",Code:"code",UserId:"userId",ReturnUrl:"returnUrl"};t.init=function(){var i=$(t.ContainerSelector),n=$("#facebook_login",i);FB.getLoginStatus(function(i){if(n.length>0){i.status==="connected"?(n.data(t.DataKeys.Authorized,!0),n.data(t.DataKeys.Code,i.authResponse.accessToken),n.data(t.DataKeys.UserId,i.authResponse.userID)):n.data(t.DataKeys.Authorized,!1);var r=n.attr("href");AJAX.get({Url:r,Callback:function(i){if(i.IsSuccess)n.data(t.DataKeys.ReturnUrl,i.Data.ReturnUrl).removeClass("disabled").css("pointer-events","").animate({opacity:1}).on("click",t.login)}})}})};t.login=function(n){n.preventDefault();var i=$(this),r=i.data(t.DataKeys.ReturnUrl),u=i.data(t.DataKeys.Authorized),f=i.data(t.DataKeys.UserId),e=i.data(t.DataKeys.Code);u===!0?t.handleConnected(f,e,r,function(){t.retryDownload(i)}):FB.login(function(n){n.status==="connected"&&t.handleConnected(n.authResponse.userID,n.authResponse.accessToken,r,function(){t.retryDownload(i)})},{scope:"email"})};t.retryDownload=function(n){var r=n.attr("data-download-file");if(r){var t=App.findModule(n.closest(".dialog_sign_up")),i=n.attr("data-action-handle");if(t&&i&&t[i])return t[i](r),!0}return!1};t.handleConnected=function(n,t,i,r){AJAX.post({Url:i+"&code="+t,Data:{userId:n},beforeHandleSuccess:function(){if(r)return r()}})}}function CollectionScroller(n,t){var i=this;if((this.minHeight=t,this.element=$(n),this.scrolled=!1,this.delay=600,this.selectorId="selector"+Math.floor(Math.random()*1e3+1),this.element.size()!=0)&&this.scrollDesired()){$(window).one("scroll."+this.selectorId,function(){i.cancelAutoScroll()});setTimeout($.proxy(this.performScroll,this),this.delay)}}function SearchFilesModel(n){var t=this;t.ContainerSelector=n;t.Context=undefined;t.form=undefined;t.Pager=undefined;t.configurePager=function(){var n=$(".view_switch .active",t.Context);n.attr("data-mode")=="List"?(t.Pager.ContainerSelector=".list_view .list_container",t.Pager.listItemsSelector=".list_row",t.Pager.splitterSelector=".pageSplitterBorder",t.Pager.mode="list"):(t.Pager.ContainerSelector=".tiles_container ul:first",t.Pager.listItemsSelector="li",t.Pager.splitterSelector=".pageSplitter",t.Pager.mode="gallery")};t.fidDialog=undefined;t.preview=function(n){if(!App.isMobile){if(t.fidDialog==undefined){var i=new FileDetailsDialogModel,r=App.findModuleByType(i);r==undefined?(t.fidDialog=i,App.register(t.fidDialog)):t.fidDialog=r}t.fidDialog.init(n)}};t.init=function(){t.Context=$(t.ContainerSelector);t.form=$("#SearchParamsForm");t.Pager=new PagerModel(undefined,t,undefined);t.Pager.usePushState=!1;t.configurePager();t.Pager.topCalculationListOffset=!1;t.Pager.additionalOffset=-15;t.Pager.loadPageHandler=t.loadNextSearchPage;t.Pager.createStateDataHandler=function(){return{}};t.Pager.init(function(){t.initImageSpinners()});t.initImageSpinners();var n=$("#jsAdvancedSearch",t.Context);$("#jsShowAdvanced",t.Context).on("click",function(i){i.preventDefault();n.attr("data-mobile")=="1"?(Windows.openFromElement(n,{dialogClass:"advanced_search",onOpen:function(n){t.initDropDown(n);Navigation.bind()},onBeforeOpen:function(n){var t=$("<div>"+n.content+"<\/div>");t.find("[data-click-bound]").removeAttr("data-click-bound");n.content=t.html()}}),$(".search_cancel_button",n).click(t.hideAdvanced),$(".search_button",n).click(function(){t.form.trigger("click")})):(n.slideDown(),$(this).hide())});$("#jsHideAdvanced",t.Context).on("click",t.hideAdvanced);t.initDropDown(t.Context);$("#jsAdvancedSearch",t.Context).hide()};t.initImageSpinners=function(){$(".thumbnail").each(function(){var n=$(this),t=n.attr("data-thumb");t!=""&&$("<img>").attr("src",t).load(function(){n.attr("data-thumb","");n.find("div.thumb_spinner").remove();n.css("background-image",'url("'+t+'")')})})};t.appendResult=function(n){t.Pager.mode=="gallery"?$("#SearchResults .tiles_container ul").append($(".tiles_container li",n)).append($(".pageSplitterBorder",n)):$("#SearchResults .list_container").append($(".list_container .list_row",n)).append($(".pageSplitterBorder",n));$(".pageSplitter a").off("click").removeAttr("data-click-bound").addClass("ignore").click(function(n){n.preventDefault()})};t.loadNextSearchPage=function(n,i){t.loadSearchPage(n,function(n){t.appendResult(n);i()})};t.initDropDown=function(n){var t=$(".select_items",n),i=$(".select",n),r=t.show().width()-33;t.hide();i.width(r);i.click(function(){$(this).parent().hasClass("disabled")||(t.slideDown("fast"),$(this).addClass("active"))});n.mouseleave(function(){t.slideUp("fast");i.removeClass("active")})};t.hideAdvanced=function(n){n.preventDefault();var i=$("#jsAdvancedSearch");i.attr("data-mobile")=="1"?i.dialog("close"):(i.slideUp(),$("#jsShowAdvanced",t.Context).show())};t.loadSearchPage=function(n,i){var r=t.form.serialize()+"&ref=pager";n&&(r+="&pageNumber="+n);AJAX.post({Url:t.form.attr("action"),Data:r,Callback:i})};t.search=function(n){n.handled();n.event.preventDefault();t.loadSearchPage(undefined,function(n){$("#SearchResults").html(n);t.Pager.init(function(){t.initImageSpinners()});FilesGallery.initImageSpinners()})};t.switchView=function(n){var i,r;n.handled();n.event.preventDefault();i=n.context.attr("data-mode");$("input[name=Mode]",t.form).val(i);r=$(".view_switch",t.form);$("[data-mode]",r).removeClass("active");$('[data-mode="'+i+'"]').addClass("active");t.configurePager();t.form.trigger("submit")};t.selectMediaType=function(n){n.handled();n.event.preventDefault();$("input[name=Type]",t.form).val(n.context.attr("data-value"));$(".select p",n.context.closest(".select_container")).text(n.context.text());n.context.closest(".ui-dialog").length?n.context.closest(".ui-dialog").trigger("mouseleave"):t.Context.trigger("mouseleave")}}function Recaptcha(n){var t=this;t.ContainerSelector=n;t.init=function(){$(t.ContainerSelector).each(function(){var n=$(this).attr("data-sitekey"),t=$(this).parents("form");grecaptcha.render(this,{sitekey:n,callback:function(n){if(n){var i=$("input:submit",t);i.attr("disabled",!1).toggleClass("disabled")}}})})}}var CollectionsList,RecomendedCollectionsList,HomePage,editCollection,FilesGallery,FileDetails,Sort,FilesList,CollectionDetails,EmptyCollection,Error,Account,abuseSettings,administrativeCollectionModel,userNotifications,userSettings,CollectionViewUpload,shareColection,oauth,SearchFiles,recaptcha;$(function(){CollectionsList=new CollectionsListModel("#collections");App.register(CollectionsList,App.Pages.Collections)});$(function(){RecomendedCollectionsList=new RecomendedCollectionsListModel("#recommended_collections");App.register(RecomendedCollectionsList)});$(function(){HomePage=new HomePageModel("div#homePage");App.register(HomePage,App.Pages.HomePage)});$(function(){editCollection=new CollectionEditModel(".headerModule");App.register(editCollection)});$(function(){FilesGallery=new FilesGalleryModel("#Gallery");App.register(FilesGallery,App.Pages.Collection)});$(function(){FileDetails=new FileDetailsModel("#fileDetails");App.register(FileDetails,App.Pages.File);$(document).keydown(function(n){var t=$(n.target);t.is("textarea")||t.is("input[type=text]")||(n.keyCode==37?$("#fileDetails .file_content a.prev").click():n.keyCode==39&&$("#fileDetails .file_content a.next").click())})});$(function(){Sort=new SortModel("#sortControl");App.register(Sort)});$(function(){FilesList=new FilesListModel("#FilesList");App.register(FilesList,App.Pages.Collection)});CollectionDetails=undefined;$(function(){CollectionDetails=new CollectionDetailsModel("#CollectionHeader");App.register(CollectionDetails,App.Pages.CollectionDetails,!1);var n=new PrivateCollectionModel("[data-private-collection-access]");App.register(n,App.Pages.PrivateCollectionDetails,!1)});$(function(){EmptyCollection=new EmptyCollectionModel("#EmptyCollection");App.register(EmptyCollection,App.Pages.Collection)});Error=null;$(function(){Error=new ErrorModel(".errorPageModule");App.register(Error,App.Pages.Error)});Account=null;$(function(){Account=new AccountModel(".AccountModule");App.register(Account)});$(function(){abuseSettings=new AbuseModel("#abuseFileDiv");App.register(abuseSettings,App.Pages.Abuse)});$(function(){var n=new MailingDemoModel("#mailingDemo");App.register(n,App.Pages.MailingDemo)});$(function(){administrativeCollectionModel=new CollectionsAdministrativeOptionsModel(".admin_info");App.register(administrativeCollectionModel)});$(function(){userNotifications=new UserNotificationsModel("#user_notifications");App.register(userNotifications)});$(function(){userSettings=new SettingsModel("#userSettingsDiv");App.register(userSettings,App.Pages.Settings)});$(function(){CollectionViewUpload=new CollectionViewUploadModel("#UploadEncouragement");App.register(CollectionViewUpload)});$(function(){shareColection=new CollectionShare("#CollectionShare");App.register(shareColection)});$(function(){oauth=new OAuthModel("#oauth");App.register(oauth)});CollectionScroller.prototype={cancelAutoScroll:function(){this.scrolled=!0},scrollDesired:function(){return $(window).height()<this.minHeight},performScroll:function(){if(!this.scrolled){this.scrolled=!0;var n=this.element.offset(),t=this.element.height();$(window).off("scroll."+this.selectorId);$(window).scrollTop(n.top+Math.round(t/2))}}};$(function(){window.CollectionScroller=new CollectionScroller(".collection_header .cover_photo",1e3)});$(function(){SearchFiles=new SearchFilesModel("#searchFiles");App.register(SearchFiles,App.Pages.SearchFiles)});$(function(){recaptcha=new Recaptcha(".g-recaptcha");App.register(recaptcha)})